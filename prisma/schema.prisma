generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum TypeAuth {
  account
  google
  facebook
}

model User {
  id             String     @id @default(uuid())
  typeAuth       TypeAuth   @default(account)
  googleId       String?    @unique
  facebookId     String?    @unique
  email          String?    @unique
  password       String?
  telegramId     String?    @unique
  name           String?
  avatarUrl      String?
  phone          String?
  timezone       String     @default("UTC")
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  prompt         String?
  topics         Topic[]
  activities     Activity[]
  streak         Int?       @default(0)
  lastActiveDate DateTime?

  @@map("users")
}

model Topic {
  id          String      @id @default(uuid())
  userId      String
  user        User        @relation(fields: [userId], references: [id])
  name        String
  description String?
  prompt      String?
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  knowledges  Knowledge[]
  questions   Question[]

  @@map("topics")
}

model Knowledge {
  id        String     @id @default(uuid())
  topicId   String
  topic     Topic      @relation(fields: [topicId], references: [id])
  name      String
  content   String
  reviewAt  DateTime?  
  avgScore  Int        @default(0) 
  createdAt DateTime   @default(now()) 
  updatedAt DateTime   @updatedAt 
  questions Question[]

  @@map("knowledges")
}

model Question {
  id          String     @id @default(uuid())
  messageId   String?
  knowledgeId String?
  knowledge   Knowledge? @relation(fields: [knowledgeId], references: [id])
  content     String
  answer      String?
  score       Int?
  aiFeedback  String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  Topic       Topic?     @relation(fields: [topicId], references: [id])
  topicId     String?

  @@map("questions")
}

model Activity {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  date      DateTime
  timezone  String   @default("UTC")
  count     Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, date, timezone])
  @@map("activities")
}
